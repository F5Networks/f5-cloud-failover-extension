{
    "$id": "initialize_schema.json",
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Cloud Failover Initialization",
    "description": "Top level schema for enabling cloud failover for BIG-IP",
    "type": "object",
    "allOf": [
        {
            "if": { "properties": { "class": { "const": "Initialize" } } },
            "then": {
                "required": ["class", "environment", "storageAccountName"],
                "properties": {
                    "class": {
                        "description": "Indicates that this property contains failover initializaton configuration.",
                        "type": "string",
                        "const": "Initialize"
                    },
                    "environment": {
                        "description": "Cloud provider environment.",
                        "type": "string",
                        "enum": ["gce", "aws", "azure"]
                    },
                    "useMetadata": {
                        "description": "Option to override gathering info from provider metadata",
                        "type": "boolean",
                        "default": true
                    },
                    "oneOf": {
                        "storageAccountName": {
                            "description": "Storage account name.",
                            "type": "string"
                        },
                        "storageTags": {
                            "description": "Unique tag(s) for identifying network interfaces or elastic IPs to be managed.",
                            "type": "array",
                            "items": [
                                {
                                    "title": "key",
                                    "type": "string"
                                },
                                {
                                    "title": "value",
                                    "type": "string"
                                }
                            ]
                        }
                    },
                    "anyOf": {
                        "managedRoutes": {
                            "description": "Route(s) this deployment will manage.",
                            "type": "array",
                            "items": {
                                "type": "string",
                                "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?$"
                            }
                        },
                        "addressTags": {
                            "description": "Unique tag(s) for identifying network interfaces or elastic IPs to be managed.",
                            "type": "array",
                            "items": [
                                {
                                    "title": "key",
                                    "type": "string"
                                },
                                {
                                    "title": "value",
                                    "type": "string"
                                }
                            ]
                        }     
                    }
                },
                "oneOf": [
                    {
                        "if": { "properties": { "environment": { "const": "azure" } } },
                        "then": {
                            "required": ["userIdentity"],
                            "userIdentity": {
                                "description": "Name of the managed user identity for getting Azure authenication tokens.",
                                "type": "string"
                            },
                            "if": { "properties": { "useMetadata": { "const": false } } },
                            "then": {
                                "required": ["subscription", "resourceGroupName", "location"],
                                    "subscription": {
                                        "description": "Azure subscription ID.",
                                        "type": "string"
                                    },
                                    "resourceGroupName": {
                                        "description": "Azure resource group name.",
                                        "type": "string"
                                    },
                                    "location": {
                                        "description": "Azure deployment location.",
                                        "type": "string",
                                        "enum": ["eastasia","southeastasia","centralus","eastus","eastus2","westus","northcentralus","southcentralus","northeurope","westeurope","japanwest","japaneast","brazilsouth","australiaeast","australiasoutheast","southindia","centralindia","westindia","canadacentral","canadaeast","uksouth","ukwest","westcentralus","westus2","koreacentral","koreasouth","francecentral","francesouth","australiacentral","australiacentral2","southafricanorth","southafricawest","usdodcentral","usdodeast","usgovarizona","usgoviowa","usgovtexas","usgovvirginia","ussecwest","usseceast"]
                                    }
                            }
                        }
                    },
                    {
                        "if": { "properties": { "environment": { "const": "aws" } } },
                        "then": {}
                    },
                    {
                        "if": { "properties": { "environment": { "const": "gce" } } },
                        "then": {
                            "then": {}
                        }
                    }
                ],
                "additionalProperties": false
            }
        }
    ]
}